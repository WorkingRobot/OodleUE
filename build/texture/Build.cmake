s_project(oodle::texture::${PROJ_NAME} ${PROJ_TYPE})

s_add_file(${oodle_data_SOURCE_DIR}/core/cpux86.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/histogram.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/log2table.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/newlz_simd.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/newlz_simd_sse4.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/oodlebase.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/oodlecoreplugins.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/oodlejob.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/oodlemalloc.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/rrbase.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/rrlog.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/rrmath.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/rrmemutil.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/rrrand.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/rrsimpleprof.cpp)
s_add_file(${oodle_data_SOURCE_DIR}/core/threadprofiler.cpp)

s_add_dir(${oodle_data_SOURCE_DIR}/texture)
s_end_sources()

s_include_directories(PRIVATE ${oodle_data_SOURCE_DIR}/core)
s_include_directories(PRIVATE ${oodle_data_SOURCE_DIR}/core/public)
s_include_directories(PRIVATE ${CMAKE_CURRENT_LIST_DIR}/include)
s_include_directories(INTERFACE ${CMAKE_SOURCE_DIR}/../Engine/Plugins/Developer/TextureFormatOodle/Sdks/${PROJECT_VERSION}/include)

if(CMAKE_SYSTEM_PROCESSOR MATCHES "^(x86_64|AMD64|i386|i686|x86)$")
s_set_arch(AVX2)
endif()
if(NOT CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
set_source_files_properties(${oodle_data_SOURCE_DIR}/texture/rrdxt1vqhelp_avx512.cpp PROPERTIES COMPILE_FLAGS "-mavx512f -mavx512vl -mavx512dq -mavx512bw")
set_source_files_properties(${oodle_data_SOURCE_DIR}/texture/rrdxtcblock_avx512.cpp PROPERTIES COMPILE_FLAGS "-mavx512f -mavx512vl -mavx512dq -mavx512bw")
endif()
s_compile_definitions(PRIVATE ${PROJ_DEF} OODLE_BUILDING_TEXTURE)

if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
    # error: invalid conversion from 'int' to '_MM_PERM_ENUM'
    s_compile_options(PRIVATE -fpermissive)
endif()